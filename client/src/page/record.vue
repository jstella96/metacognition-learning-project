<template>
<div id="record">
  <el-row type="flex"  justify="center">
    <el-col :span="22" class="logo">
    <el-col :span="4">
     <router-link to="/" >
        <h2>LOGO</h2>
      </router-link>
     </el-col> 
    </el-col>
  </el-row>
  <el-row  type="flex"  justify="center">
    <el-col :span="14" class="left-side">
        <record-video :state="state" @putVideoInfo="putVideoInfo"></record-video>
        <control-bottom v-if="state !== 'stop' && state !== 'upload'" :state="state" @changeState="changeState"></control-bottom>
        <menu-bottom v-else :state="state" @changeState="changeState" ></menu-bottom>
    </el-col>
    <el-col :span="8">
      <md-script :text="desc" @changeDesc="changeDesc"> </md-script> 
    </el-col>
  </el-row>
</div>
</template>
<script>
import ControlBottom from '../components/control-bottom.vue'
import MdScript from '../components/md-script.vue'
import RecordVideo from '../components/recode-video.vue'
import MenuBottom from '../components/menu-bottom.vue'
import axios from 'axios'
export default {
  name: 'Watch',
  components: { 
    "control-bottom": ControlBottom,
    "md-script" : MdScript,
    "record-video":RecordVideo,
    "menu-bottom": MenuBottom
  },
  data(){
    return{
      isControlBottom:true,
      editor:null,
      chunks:[],
      state: 'ready',
      desc: ''
    }
  },
  mounted(){

  },
  created(){
   
  },
  methods: {
    changeState(nextState){
      this.state = nextState;
    },
    changeDesc(nextDesc){
      this.desc = nextDesc
    },
    async putVideoInfo(videoKey){
      try{
        const desc = this.desc;
        let id = new Date().getTime(); // uuid 로 변경
        id = String(id)
        const body = {id, desc, videoKey}
        await axios.put(`/api/videos`,body);
        this.$router.replace(`watch/${id}`)
           }catch(err){
        console.log(err)
      }
    },
  },

}
</script>